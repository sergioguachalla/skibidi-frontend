<navbar></navbar>

<!-- Lista de Multas -->
<div class="container my-4">
  <h3>Lista de Multas</h3>

  <table class="table table-striped table-bordered">
    <thead>
      <tr>
        <th>ID</th>
        <th>Tipo de Multa</th>
        <th>Fecha de Vencimiento</th>
        <th>Monto (Bs.)</th>
        <th>Estado</th>
        <th>Usuario</th>
        <th>Fecha de Pago</th>
        <th>Acciones</th>
        <th>Préstamo Permitido</th>
      </tr>
    </thead>
    <tbody>
      <!-- Iteración sobre fines -->
      <tr *ngFor="let fine of fines" [ngClass]="{'gray-row': !fine.canBorrowBooks}">
        <td>{{ fine.fineId }}</td>
        <td>{{ fine.typeFine }}</td>
        <td>{{ fine.dueDate || 'N/A' }}</td>
        <td>{{ fine.amount }}</td>
        <td [ngClass]="{'status-pending': fine.status === 'Pendiente', 'status-paid': fine.status === 'Pagada'}">
          {{ fine.status }}
        </td>
        <td class="username-link" (click)="showFineDetail(fine.fineId)"> {{ fine.username }} </td>
        <td>{{ fine.paidDate }}</td>
        <td>
          <button 
            *ngIf="fine.status === 'Pendiente'" 
            class="btn" 
            [ngClass]="{'btn-warning': fine.canBorrowBooks, 'btn-success': !fine.canBorrowBooks}" 
            (click)="openConfirmModal(fine)">
            {{ fine.canBorrowBooks ? 'Bloquear Préstamos' : 'Desbloquear Préstamos' }}
          </button>
        </td>
        <td>{{ fine.canBorrowBooks ? 'Sí' : 'No' }}</td>
      </tr>
    </tbody>
  </table>

  <!-- Paginación -->
  <nav *ngIf="totalPages > 1">
    <ul class="pagination justify-content-center">
      <li class="page-item" [class.disabled]="currentPage === 0">
        <button class="page-link" (click)="onPageChange(currentPage - 1)">Anterior</button>
      </li>
      <li
        class="page-item"
        *ngFor="let page of pagesArray"
        [class.active]="page === currentPage"
      >
        <button class="page-link" (click)="onPageChange(page)">{{ page + 1 }}</button>
      </li>
      <li class="page-item" [class.disabled]="currentPage === totalPages - 1">
        <button class="page-link" (click)="onPageChange(currentPage + 1)">Siguiente</button>
      </li>
    </ul>
  </nav>
</div>

<!-- Modal de Confirmación -->
<div *ngIf="isConfirmModalOpen" class="modal fade show d-block" style="display:block; z-index: 1050;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Confirmar Acción</h5>
        <button type="button" class="close" (click)="closeConfirmModal()">&times;</button>
      </div>
      <div class="modal-body">
        <p>¿Estás seguro de que deseas {{ selectedFine?.canBorrowBooks ? 'bloquear' : 'desbloquear' }} los préstamos para este usuario?</p>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" (click)="confirmBlock()">Confirmar</button>
        <button class="btn btn-secondary" (click)="closeConfirmModal()">Cancelar</button>
      </div>
    </div>
  </div>
</div>
